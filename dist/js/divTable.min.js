/*! divTable v0.1.0 | AGPL http://www.gnu.org/licenses/ */
"use strict";var TAFFY,exports,T;!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(!TAFFY)for(e="2.7",f=1,g="000000",h=1e3,i={},j=function(a){return TAFFY.isArray(a)||TAFFY.isObject(a)?a:JSON.parse(a)},s=function(a,b){return t(a,function(a){return b.indexOf(a)>=0})},t=function(a,b,c){var d=[];return null==a?d:Array.prototype.filter&&a.filter===Array.prototype.filter?a.filter(b,c):(k(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)},v=function(a){var b=T.isArray(a)?[]:T.isObject(a)?{}:null;if(null===a)return a;for(var c in a)b[c]=w(a[c])?a[c].toString():T.isArray(a[c])||T.isObject(a[c])?v(a[c]):a[c];return b},u=function(a){var b=JSON.stringify(a);return null===b.match(/regex/)?b:JSON.stringify(v(a))},k=function(a,b,c){var d,e,f,g;if(a&&(T.isArray(a)&&1===a.length||!T.isArray(a)))b(T.isArray(a)?a[0]:a,0);else for(f=0,a=T.isArray(a)?a:[a],g=a.length;g>f&&(e=a[f],T.isUndefined(e)&&!c||(d=b(e,f),d!==T.EXIT));f++);},l=function(a,b){var c,d,e=0;for(d in a)if(a.hasOwnProperty(d)&&(c=b(a[d],d,e++),c===T.EXIT))break},i.extend=function(a,b){i[a]=function(){return b.apply(this,arguments)}},m=function(a){var b;return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)?!0:T.isObject(a)&&a.___id&&a.___s?!0:T.isArray(a)?(b=!0,k(a,function(a){return m(a)?void 0:(b=!1,TAFFY.EXIT)}),b):!1},o=function(a,b){var c=!0;return k(b,function(b){switch(T.typeOf(b)){case"function":if(!b.apply(a))return c=!1,TAFFY.EXIT;break;case"array":c=1===b.length?o(a,b[0]):2===b.length?o(a,b[0])||o(a,b[1]):3===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2]):4===b.length?o(a,b[0])||o(a,b[1])||o(a,b[2])||o(a,b[3]):!1,b.length>4&&k(b,function(b){o(a,b)&&(c=!0)})}}),c},n=function(a){var b=[];return T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&(a={___id:a}),T.isArray(a)?(k(a,function(a){b.push(n(a))}),a=function(){var a=this,c=!1;return k(b,function(b){o(a,b)&&(c=!0)}),c}):T.isObject(a)?(T.isObject(a)&&a.___id&&a.___s&&(a={___id:a.___id}),l(a,function(a,c){T.isObject(a)||(a={is:a}),l(a,function(a,d){var e,f=[];e="hasAll"===d?function(a,b){b(a)}:k,e(a,function(a){var b,e=!0;b=function(){var b,f=""+this[c],g="==",h="!=",i="===",j="<",k=">",l="<=",m=">=",n="!==";return"undefined"==typeof f?!1:(0===d.indexOf("!")&&d!==h&&d!==n&&(e=!1,d=d.substring(1,d.length)),b="regex"===d?a.test(f):"lt"===d||d===j?a>f:"gt"===d||d===k?f>a:"lte"===d||d===l?a>=f:"gte"===d||d===m?f>=a:"left"===d?0===f.indexOf(a):"leftnocase"===d?0===f.toLowerCase().indexOf(a.toLowerCase()):"right"===d?f.substring(f.length-a.length)===a:"rightnocase"===d?f.toLowerCase().substring(f.length-a.length)===a.toLowerCase():"like"===d?f.indexOf(a)>=0:"likenocase"===d?f.toLowerCase().indexOf(a.toLowerCase())>=0:d===i||"is"===d?f===a:d===g?f==a:d===n?f!==a:d===h?f!=a:"isnocase"===d?f.toLowerCase?f.toLowerCase()===a.toLowerCase():f===a:"has"===d?T.has(f,a):"hasall"===d?T.hasAll(f,a):"contains"===d?TAFFY.isArray(f)&&f.indexOf(a)>-1:-1!==d.indexOf("is")||TAFFY.isNull(f)||TAFFY.isUndefined(f)||TAFFY.isObject(a)||TAFFY.isArray(a)?T[d]&&T.isFunction(T[d])&&0===d.indexOf("is")?T[d](f)===a:T[d]&&T.isFunction(T[d])?T[d](f,a):!1:a===f[d],b=b&&!e?!1:b||e?b:!0)},f.push(b)}),b.push(1===f.length?f[0]:function(){var a=this,b=!1;return k(f,function(c){c.apply(a)&&(b=!0)}),b})})}),a=function(){var a=this,c=!0;return c=(1!==b.length||b[0].apply(a))&&(2!==b.length||b[0].apply(a)&&b[1].apply(a))&&(3!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a))&&(4!==b.length||b[0].apply(a)&&b[1].apply(a)&&b[2].apply(a)&&b[3].apply(a))?!0:!1,b.length>4&&k(b,function(b){o(a,b)||(c=!1)}),c}):T.isFunction(a)?a:void 0},q=function(a,b){var c=function(a,c){var d=0;return T.each(b,function(b){var e,f,g,h,i;if(e=b.split(" "),f=e[0],g=1===e.length?"logical":e[1],"logical"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]<i[b]?(d=-1,TAFFY.EXIT):h[b]>i[b]?(d=1,TAFFY.EXIT):void 0});else if("logicaldesc"===g)h=p(a[f]),i=p(c[f]),T.each(h.length<=i.length?h:i,function(a,b){return h[b]>i[b]?(d=-1,TAFFY.EXIT):h[b]<i[b]?(d=1,TAFFY.EXIT):void 0});else{if("asec"===g&&a[f]<c[f])return d=-1,T.EXIT;if("asec"===g&&a[f]>c[f])return d=1,T.EXIT;if("desc"===g&&a[f]>c[f])return d=-1,T.EXIT;if("desc"===g&&a[f]<c[f])return d=1,T.EXIT}return 0===d&&"logical"===g&&h.length<i.length?d=-1:0===d&&"logical"===g&&h.length>i.length?d=1:0===d&&"logicaldesc"===g&&h.length>i.length?d=-1:0===d&&"logicaldesc"===g&&h.length<i.length&&(d=1),0!==d?T.EXIT:void 0}),d};return a&&a.push?a.sort(c):a},function(){var a={},b=0;p=function(c){return b>h&&(a={},b=0),a["_"+c]||function(){var d,e,f,g=String(c),h=[],i="_",j="";for(d=0,e=g.length;e>d;d++)f=g.charCodeAt(d),f>=48&&57>=f||46===f?("n"!==j&&(j="n",h.push(i.toLowerCase()),i=""),i+=g.charAt(d)):("s"!==j&&(j="s",h.push(parseFloat(i)),i=""),i+=g.charAt(d));return h.push("n"===j?parseFloat(i):i.toLowerCase()),h.shift(),a["_"+c]=h,b++,h}()}}(),r=function(){this.context({results:this.getDBI().query(this.context())})},i.extend("filter",function(){var a=TAFFY.mergeObj(this.context(),{run:null}),b=[];return k(a.q,function(a){b.push(a)}),a.q=b,k(arguments,function(b){a.q.push(n(b)),a.filterRaw.push(b)}),this.getroot(a)}),i.extend("order",function(a){a=a.split(",");var b,c=[];return k(a,function(a){c.push(a.replace(/^\s*/,"").replace(/\s*$/,""))}),b=TAFFY.mergeObj(this.context(),{sort:null}),b.order=c,this.getroot(b)}),i.extend("limit",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.limit=a,c.run&&c.sort&&(b=[],k(c.results,function(c,d){return d+1>a?TAFFY.EXIT:void b.push(c)}),c.results=b),this.getroot(c)}),i.extend("start",function(a){var b,c=TAFFY.mergeObj(this.context(),{});return c.start=a,c.run&&c.sort&&!c.limit?(b=[],k(c.results,function(c,d){d+1>a&&b.push(c)}),c.results=b):c=TAFFY.mergeObj(this.context(),{run:null,start:a}),this.getroot(c)}),i.extend("update",function(a,b,c){var d,e=!0,f={},g=arguments;return!TAFFY.isString(a)||2!==arguments.length&&3!==arguments.length?(f=a,2===g.length&&(e=b)):(f[a]=b,3===arguments.length&&(e=c)),d=this,r.call(this),k(this.context().results,function(a){var b=f;TAFFY.isFunction(b)?b=b.apply(TAFFY.mergeObj(a,{})):T.isFunction(b)&&(b=b(TAFFY.mergeObj(a,{}))),TAFFY.isObject(b)&&d.getDBI().update(a.___id,b,e)}),this.context().results.length&&this.context({run:null}),this}),i.extend("remove",function(a){var b=this,c=0;return r.call(this),k(this.context().results,function(a){b.getDBI().remove(a.___id),c++}),this.context().results.length&&(this.context({run:null}),b.getDBI().removeCommit(a)),c}),i.extend("count",function(){return r.call(this),this.context().results.length}),i.extend("callback",function(a,b){if(a){var c=this;setTimeout(function(){r.call(c),a.call(c.getroot(c.context()))},b||0)}return null}),i.extend("get",function(){return r.call(this),this.context().results}),i.extend("stringify",function(){return JSON.stringify(this.get())}),i.extend("first",function(){return r.call(this),this.context().results[0]||!1}),i.extend("last",function(){return r.call(this),this.context().results[this.context().results.length-1]||!1}),i.extend("sum",function(){var a=0,b=this;return r.call(b),k(arguments,function(c){k(b.context().results,function(b){a+=b[c]||0})}),a}),i.extend("min",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]<b)&&(b=c[a])}),b}),function(){var a=function(){var a,b,c;return a=function(a,b,c){var d,e,f;switch(2===c.length?(d=a[c[0]],f="===",e=b[c[1]]):(d=a[c[0]],f=c[1],e=b[c[2]]),f){case"===":return d===e;case"!==":return d!==e;case"<":return e>d;case">":return d>e;case"<=":return e>=d;case">=":return d>=e;case"==":return d==e;case"!=":return d!=e;default:throw String(f)+" is not supported"}},b=function(a,b){var c,d,e={};for(c in a)a.hasOwnProperty(c)&&(e[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&"___id"!==c&&"___s"!==c&&(d=TAFFY.isUndefined(e[c])?"":"right_",e[d+String(c)]=b[c]);return e},c=function(c){var d,e,f=arguments,g=f.length,h=[];if("function"!=typeof c.filter){if(!c.TAFFY)throw"TAFFY DB or result not supplied";d=c()}else d=c;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(c){d.each(function(d){var i,j=!0;a:for(e=1;g>e&&(i=f[e],j="function"==typeof i?i(c,d):"object"==typeof i&&i.length?a(c,d,i):!1,j);e++);j&&h.push(b(c,d))})}),TAFFY(h)()}}();i.extend("join",a)}(),i.extend("max",function(a){var b=null;return r.call(this),k(this.context().results,function(c){(null===b||c[a]>b)&&(b=c[a])}),b}),i.extend("select",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){a.push(c[b[0]])}):k(this.context().results,function(c){var d=[];k(b,function(a){d.push(c[a])}),a.push(d)}),a}),i.extend("distinct",function(){var a=[],b=arguments;return r.call(this),1===arguments.length?k(this.context().results,function(c){var d=c[b[0]],e=!1;k(a,function(a){return d===a?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}):k(this.context().results,function(c){var d=[],e=!1;k(b,function(a){d.push(c[a])}),k(a,function(a){var c=!0;return k(b,function(b,e){return d[e]!==a[e]?(c=!1,TAFFY.EXIT):void 0}),c?(e=!0,TAFFY.EXIT):void 0}),e||a.push(d)}),a}),i.extend("supplant",function(a,b){var c=[];return r.call(this),k(this.context().results,function(b){c.push(a.replace(/\{([^\{\}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a}))}),b?c:c.join("")}),i.extend("each",function(a){return r.call(this),k(this.context().results,a),this}),i.extend("map",function(a){var b=[];return r.call(this),k(this.context().results,function(c){b.push(a(c))}),b}),T=function(a){var b,c,d,e=[],h={},p=1,r={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},s=new Date,t=0,v=0,w={};return c=function(a){var b=[],d=!1;return 0===a.length?e:(k(a,function(a){T.isString(a)&&/[t][0-9]*[r][0-9]*/i.test(a)&&e[h[a]]&&(b.push(e[h[a]]),d=!0),T.isObject(a)&&a.___id&&a.___s&&e[h[a.___id]]&&(b.push(e[h[a.___id]]),d=!0),T.isArray(a)&&k(a,function(a){k(c(a),function(a){b.push(a)})})}),d&&b.length>1&&(b=[]),b)},b={dm:function(a){return a&&(s=a,w={},t=0,v=0),r.onDBChange&&setTimeout(function(){r.onDBChange.call(e)},0),r.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))}),s},insert:function(a,c){var i=[],m=[],n=j(a);return k(n,function(a,d){var j,n;return T.isArray(a)&&0===d?(k(a,function(a){i.push("lower"===r.forcePropertyCase?a.toLowerCase():"upper"===r.forcePropertyCase?a.toUpperCase():a)}),!0):(T.isArray(a)?(j={},k(a,function(a,b){j[i[b]]=a}),a=j):T.isObject(a)&&r.forcePropertyCase&&(n={},l(a,function(b,c){n["lower"===r.forcePropertyCase?c.toLowerCase():"upper"===r.forcePropertyCase?c.toUpperCase():c]=a[c]}),a=n),p++,a.___id="T"+String(g+f).slice(-6)+"R"+String(g+p).slice(-6),a.___s=!0,m.push(a.___id),r.template&&(a=T.mergeObj(r.template,a)),e.push(a),h[a.___id]=e.length-1,r.onInsert&&(c||TAFFY.isUndefined(c))&&r.onInsert.call(a),void b.dm(new Date))}),d(m)},sort:function(a){return e=q(e,a.split(",")),h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date),!0},update:function(a,c,d){var f,g,i,j,k={};r.forcePropertyCase&&(l(c,function(a,b){k["lower"===r.forcePropertyCase?b.toLowerCase():"upper"===r.forcePropertyCase?b.toUpperCase():b]=a}),c=k),f=e[h[a]],g=T.mergeObj(f,c),i={},j=!1,l(g,function(a,b){(TAFFY.isUndefined(f[b])||f[b]!==a)&&(i[b]=a,j=!0)}),j&&(r.onUpdate&&(d||TAFFY.isUndefined(d))&&r.onUpdate.call(g,e[h[a]],i),e[h[a]]=g,b.dm(new Date))},remove:function(a){e[h[a]].___s=!1},removeCommit:function(a){var c;for(c=e.length-1;c>-1;c--)e[c].___s||(r.onRemove&&(a||TAFFY.isUndefined(a))&&r.onRemove.call(e[c]),h[e[c].___id]=void 0,e.splice(c,1));h={},k(e,function(a,b){h[a.___id]=b}),b.dm(new Date)},query:function(a){var d,f,g,h,i,j;if(r.cacheSize&&(f="",k(a.filterRaw,function(a){return T.isFunction(a)?(f="nocache",TAFFY.EXIT):void 0}),""===f&&(f=u(T.mergeObj(a,{q:!1,run:!1,sort:!1})))),!a.results||!a.run||a.run&&b.dm()>a.run){if(g=[],r.cacheSize&&w[f])return w[f].i=t++,w[f].results;0===a.q.length&&0===a.index.length?(k(e,function(a){g.push(a)}),d=g):(h=c(a.index),k(h,function(b){(0===a.q.length||o(b,a.q))&&g.push(b)}),d=g)}else d=a.results;return!(a.order.length>0)||a.run&&a.sort||(d=q(d,a.order)),d.length&&(a.limit&&a.limit<d.length||a.start)&&(i=[],k(d,function(b,c){if(!a.start||a.start&&c+1>=a.start)if(a.limit){if(j=a.start?c+1-a.start:c,j<a.limit)i.push(b);else if(j>a.limit)return TAFFY.EXIT}else i.push(b)}),d=i),r.cacheSize&&"nocache"!==f&&(v++,setTimeout(function(){var a,b;v>=2*r.cacheSize&&(v=0,a=t-r.cacheSize,b={},l(function(c,d){c.i>=a&&(b[d]=c)}),w=b)},0),w[f]={i:t++,results:d}),d}},d=function(){var a,c;return a=TAFFY.mergeObj(TAFFY.mergeObj(i,{insert:void 0}),{getDBI:function(){return b},getroot:function(a){return d.call(a)},context:function(a){return a&&(c=TAFFY.mergeObj(c,a.hasOwnProperty("results")?TAFFY.mergeObj(a,{run:new Date,sort:new Date}):a)),c},extend:void 0}),c=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:r},k(arguments,function(a){m(a)?c.index.push(a):c.q.push(n(a)),c.filterRaw.push(a)}),a},f++,a&&b.insert(a),d.insert=b.insert,d.merge=function(a,c,e){var f={},g=[],h={};return e=e||!1,c=c||"id",k(a,function(a){var h;f[c]=a[c],g.push(a[c]),h=d(f).first(),h?b.update(h.___id,a,e):b.insert(a,e)}),h[c]=g,d(h)},d.TAFFY=!0,d.sort=b.sort,d.settings=function(a){return a&&(r=TAFFY.mergeObj(r,a),a.template&&d().update(a.template)),r},d.store=function(a){var b,c=!1;return localStorage&&(a&&(b=localStorage.getItem("taffy_"+a),b&&b.length>0&&(d.insert(b),c=!0),e.length>0&&setTimeout(function(){localStorage.setItem("taffy_"+r.storageName,JSON.stringify(e))})),d.settings({storageName:a})),d},d},TAFFY=T,T.each=k,T.eachin=l,T.extend=i.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(a,b){var c={};return l(a,function(b,d){c[d]=a[d]}),l(b,function(a,d){c[d]=b[d]}),c},TAFFY.has=function(a,b){var c,d=!1;if(a.TAFFY)return d=a(b),d.length>0?!0:!1;switch(T.typeOf(a)){case"object":if(T.isObject(b))l(b,function(c,e){return d!==!0||T.isUndefined(a[e])||!a.hasOwnProperty(e)?(d=!1,TAFFY.EXIT):void(d=T.has(a[e],b[e]))});else if(T.isArray(b))k(b,function(c,e){return d=T.has(a,b[e]),d?TAFFY.EXIT:void 0});else if(T.isString(b))return TAFFY.isUndefined(a[b])?!1:!0;return d;case"array":if(T.isObject(b))k(a,function(c,e){return d=T.has(a[e],b),d===!0?TAFFY.EXIT:void 0});else if(T.isArray(b))k(b,function(c,e){return k(a,function(c,f){return d=T.has(a[f],b[e]),d===!0?TAFFY.EXIT:void 0}),d===!0?TAFFY.EXIT:void 0});else if(T.isString(b)||T.isNumber(b))for(d=!1,c=0;c<a.length;c++)if(d=T.has(a[c],b))return!0;return d;case"string":if(T.isString(b)&&b===a)return!0;break;default:if(T.typeOf(a)===T.typeOf(b)&&a===b)return!0}return!1},TAFFY.hasAll=function(a,b){var c,d=TAFFY;return d.isArray(b)?(c=!0,k(b,function(b){return c=d.has(a,b),c===!1?TAFFY.EXIT:void 0}),c):d.has(a,b)},TAFFY.typeOf=function(a){var b=typeof a;return"object"===b&&(a?"number"!=typeof a.length||a.propertyIsEnumerable("length")||(b="array"):b="null"),b},TAFFY.getObjectKeys=function(a){var b=[];return l(a,function(a,c){b.push(c)}),b.sort(),b},TAFFY.isSameArray=function(a,b){return TAFFY.isArray(a)&&TAFFY.isArray(b)&&a.join(",")===b.join(",")?!0:!1},TAFFY.isSameObject=function(a,b){var c=TAFFY,d=!0;return c.isObject(a)&&c.isObject(b)&&c.isSameArray(c.getObjectKeys(a),c.getObjectKeys(b))?l(a,function(e,f){return c.isObject(a[f])&&c.isObject(b[f])&&c.isSameObject(a[f],b[f])||c.isArray(a[f])&&c.isArray(b[f])&&c.isSameArray(a[f],b[f])||a[f]===b[f]?void 0:(d=!1,TAFFY.EXIT)}):d=!1,d},a=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],b=function(a){return function(b){return TAFFY.typeOf(b)===a.toLowerCase()?!0:!1}},c=0;c<a.length;c++)d=a[c],TAFFY["is"+d]=b(d)}(),"object"==typeof exports&&(exports.taffy=TAFFY);var inherit=function(a){function b(){}return b.prototype=a,new b},divTableMaker=function(){var a=function(){};a.prototype.init=function(a,b,c){var d=this;this.callback_context=c,this.filter={},this._loadOptions(b),this._buildAdvancedEdit(),this._buildRowEditor(),this._buildTableStructure(a),this._setDomMap(a),this._addEventHandlers(),this._saveMap={},this.newTable(),setTimeout(function(){d._emitCallback("onCreate"),d.saveStatus()},0)},a.prototype._loadOptions=function(a){var b,a=inherit(a),c={class_prefix:"div",select_class:"select",edit_class:"edit",filter_class:"filter",hide_class:"hide",columns:[{name:"first",text:"first",edit:"text"},{name:"second",text:"second",edit:["0","1","2"]}],footer:["plus","trash"],counter_text:"Entry {{from}} - {{to}} of {{total}}",order:"id",show_filter:!1,auto_edit:!0,menu:'<ul id="configMenuUl" styel="width:120px"><li id="menuitem-headerfilter"><a href="#"><span class="ui-icon ui-icon-filter"></span>Filter</a></li></ul>',advancedEdit:null,onChange:function(){},onSelectRow:function(){},onFooterClick:function(a){"plus"===a?this.div_table("newRow"):"trash"===a&&this.div_table("deleteSelectedRow")}};for(b in c)void 0===a[b]&&(a[b]=c[b]);this.options=a},a.prototype._emitCallback=function(a,b){var c;if("function"==typeof this.options[a]){switch(a){case"onCreate":c=[];break;case"onFooterClick":c=[b];break;case"onSelectRow":c=[b];break;case"onChange":c=b;break;default:c=[]}this.options[a].apply(this.callback_context,c)}},a.prototype._getRows=function(a){var c=b.extend(this.filter,a||{});return c=b.extend(c,{deleted:"false"}),this.table(c).order(this.options.order||"id").get()},a.prototype._getRowById=function(a){var b=this._getRows({id:1*a})[0];return b||(b=this._getRows({id:""+a})[0]),b},a.prototype._insertRow=function(a){var b,c,d=this.options.columns;for(a.deleted="false",a.edited="false",a.new="true",a.id=a.id||(new Date).getTime(),this._checkRowValues(a),b=0,c=d.length;c>b;b++)a.hasOwnProperty(d[b].name)||(a[d[b].name]="");this.table.insert(a)},a.prototype._updateRow=function(a,b,c){c||this.table({id:a,"new":"false",edited:"false"}).update({edited:"true"}),this.table({id:""+a}).first()?a=""+a:a*=a,this.table({id:a}).update(b)},a.prototype._deleteRow=function(a){this.table({id:a,"new":"false"}).count()?this.table({id:a}).update({deleted:"true"}):this.table({id:a}).remove()},a.prototype._checkRowValues=function(a){var c,d,e,f,g,h;c=this.edit.getEdit(a);for(g in c)if(c.hasOwnProperty(g))if(b.isObject(c[g])){if(!c[g].hasOwnProperty(a[g])){for(h in c[g])break;a[g]=h}}else b.isArray(c[g])&&(b.inArray(a[g],c[g])||(a[g]=c[g][0]));for(d=this.edit.getHidden(a),e=0,f=d.length;f>e;e++)a[d[e]]=null},a.prototype._getUniqueValues=function(a,c,d,e){var f,g,h,i,j,k={},l=b.clone(d);if(!a)return l;if(e&&(k[e]={isnocase:a[e]}),f=this._getRows(k),g=b.getArrayByKey(f,c),b.isArray(l)){a:for(h=0,j=g.length;j>h;++h)if(g[h]!==a[c])for(i=l.length;i--;)if(g[h]===l[i]){l.splice(i,1);continue a}}else if(b.isObject(l))for(h=0,j=g.length;j>h;++h)g[h]!==a[c]&&l.hasOwnProperty(g[h])&&delete l[g[h]];return l},a.prototype._buildAdvancedEdit=function(){var a,c,d=this,e=this.options.advancedEdit,f=function(b,c){var d,e,g=new a(b.edit,b.hide,b.depend);if(b.values)for(d=0,e=b.values.length;e>d;++d)f(b.values[d],g);return c?(c.addChild(b.value,b.invert||!1,g),c):g};a=function(a,b,c){this.edit=a||{},this.hide=b||[],this.depend=c,this.children=[]},a.prototype={getEdit:function(a){if(this.depend){var c=this.getChild(a);return c?extend(this.edit,c.getEdit(a)):b.clone(this.edit)}return b.clone(this.edit)},getHidden:function(a){if(this.depend){var b=this.getChild(a);return b?this.hide.concat(b.getHidden(a)):this.hide}return this.hide},getDepend:function(){var a,b,c=this.depend?[this.depend]:[];if(this.children.length)for(a=0,b=this.children.length;b>a;++a)c=c.concat(this.children[a].child.getDepend());return c},addChild:function(a,b,c){this.children.push({value:a,invert:b,child:c})},getChild:function(a){var c,d,e,f=this.depend,g=a[f];for(c=0,d=this.children.length;d>c;++c)if(e=this.children[c],!e.invert!=!(e.value===g||b.inArray(g,e.value)))return e.child}},c=f(e||{});var g=function(a){this.edit=a};g.prototype={getEdit:function(){var a,b,c,e,f=arguments[0],g=arguments[1]||!1,h=d.options.columns,i=this.edit.getEdit.apply(this.edit,arguments);for(a=0,b=h.length;b>a;a++)c=h[a].name,i[c]||(i[c]=h[a].edit),!g&&h[a].unique&&(i[c]=d._getUniqueValues(f,c,i[c])),"function"==typeof i[c]&&(i[c]=i[c](f));for(e=this.getHidden.apply(this,arguments),a=0,b=e.length;b>a;a++)i[e[a]]&&(i[e[a]]="hidden");return i},getHidden:function(){return this.edit.getHidden.apply(this.edit,arguments)},getDepend:function(){return this.edit.getDepend.apply(this.edit,arguments)}},this.edit=new g(c)},a.prototype._buildRowEditor=function(){{var a,c,d,e,f,g,h,i,j,k,l=this;this.options.columns}a=function(){this.subscribed={}},a.prototype={subscribe:function(a,b,c){var d=(new Date).getTime();return this.subscribed.hasOwnProperty(a)||(this.subscribed[a]={}),this.subscribed[a][d]={fn:b,ctx:c||this},d},emit:function(a,b){var c,d;if(this.subscribed.hasOwnProperty(a))for(c in this.subscribed[a])this.subscribed[a].hasOwnProperty(c)&&(d=this.subscribed[a][c],d.fn.call(d.ctx,b))}},c=function(b,c){a.call(this);var d='[name="'+b+'"]';this.editor=null,this.column_name=b,this.editor_class=l.options.class_prefix+"-"+l.options.edit_class,this.row=c,this.cell=c?c.querySelector(d):null,this.editor=null},c.prototype=new a,c.prototype.constructor=c,c.prototype.getValue=function(){var a=this.row.id;return l._getRowById(a)[this.column_name]},c.prototype.setValue=function(a,b){var c=this.row.id,d={};d[this.column_name]=a,l._updateRow(c,d),b||this.emit("change",{column:this.column_name,value:a})},c.prototype.destroy=function(){this.editor&&this.editor.parentNode&&this.editor.parentNode.removeChild(this.editor)},c.prototype.init=function(){},c.prototype.update=function(a){this.cell&&(this.cell.innerHTML=a),this.setValue(a,!0)},d=function(a,b){c.call(this,a,b)},d.prototype=new c,d.prototype.constructor=d,d.prototype.init=function(){var a=this,c=this.getValue()||"",d=document.createElement("input");d.className=this.editor_class,d.setAttribute("type","text"),d.value=c,this.cell.insertBefore(d,this.cell.firstChild),this.editor=d,b.addEvent(d,"keyup",function(){a.setValue(this.value)})},e=function(a,b){c.call(this,a,b)},e.prototype=new c,e.prototype.constructor=e,e.prototype.init=function(){var a=this,c=this.getValue()||0,d=document.createElement("input");d.className=this.editor_class,d.setAttribute("type","number"),d.value=c,this.cell.insertBefore(d,this.cell.firstChild),this.editor=d,b.addEvent(d,"keyup",function(){a.setValue(this.value)})},f=function(a,b){c.call(this,a,b)},f.prototype=new c,f.prototype.constructor=f,f.prototype.init=function(a){var c,d,e,f,g=this,h=a.values||[],i=this.getValue(),j=document.createElement("select"),k=[],l=!1;for(j.className=this.editor_class,c=0,d=h.length;d>c;++c)e=h[c],e==i?(f='selected="selected"',l=!0):f="",k.push('<option value="'+e+'" '+f+' name="'+c+'">'+e+"</option>");b.addEvent(j,"change",function(){g.setValue(this.value)}),j.innerHTML=k.join(""),l||this.setValue(j.value),this.cell.insertBefore(j,this.cell.firstChild),this.editor=j},g=function(a,b){c.call(this,a,b)},g.prototype=new c,g.prototype.constructor=g,g.prototype.init=function(a){var c,d,e=this,f=a.values||[],g=this.getValue(),h=document.createElement("select"),i=[],j=!1;h.className=this.editor_class;for(c in f)c==g?(d='selected="selected"',j=!0):d="",i.push('<option value="'+c+'" '+d+">"+f[c]+"</option>");b.addEvent(h,"change",function(){e.setValue(this.value)}),h.innerHTML=i.join(""),j||this.setValue(h.value),this.cell.insertBefore(h,this.cell.firstChild),this.editor=h},h=function(a,b){c.call(this,a,b)},h.prototype=new c,h.prototype.constructor=h,h.prototype.init=function(){var a=this,b=this.getValue()||"",c=document.createElement("input");c.className=this.editor_class,c.value=b,this.cell.insertBefore(c,this.cell.firstChild),this.editor=c,$(c).datetimepicker({showTimepicker:!1,onSelect:function(){a.setValue(this.value)}})},h.prototype.destroy=function(){$(this.editor).datetimepicker("destroy")},i=function(a,b){c.call(this,a,b)},i.prototype=new c,i.prototype.constructor=i,i.prototype.init=function(){var a,b=this,c=this.getValue()||"00:00",d=document.createElement("input");d.className=this.editor_class,d.value=c,this.cell.insertBefore(d,this.cell.firstChild),this.editor=d,a=new TimePicker({target:d,h_min:4,h_max:27}),a.subscribe("change",function(a){b.setValue(a)})},j=function(a,b){c.call(this,a,b)},j.prototype=new c,j.prototype.constructor=j,j.prototype.init=function(){var a=this,c=this.getValue()||!1,d=document.createElement("input");d.className=this.editor_class,d.setAttribute("type","checkbox"),d.checked=c,this.cell.insertBefore(d,this.cell.firstChild),this.editor=d,b.addEvent(d,"change",function(){a.setValue(this.checked)})},k=function(a,b){c.call(this,a,b)},k.prototype=new c,k.prototype.constructor=k,k.prototype.init=function(){var a=document.createElement("div");a.className=this.editor_class+"-hidden",this.cell.insertBefore(a,this.cell.firstChild),this.editor=a};var m=function(){this.editingId=null,this.editingMap={},this.onChange=null};m.prototype.getEditorType=function(a){var l,m;return"text"===a?(l="text",m=d):"number"===a?(l="number",m=e):b.isArray(a)?(l="select",m=f):b.isObject(a)?(l="advancedSelect",m=g):"date"===a?(l="date",m=h):"time"===a?(l="time",m=i):"checkbox"===a?(l="checkbox",m=j):"hidden"===a?(l="hidden",m=k):(l="none",m=c),{type:l,Constructor:m}},m.prototype._editCell=function(a,b){var c,d=this.getEditorType(b),e=d.type;c=new d.Constructor(a,this.row),c.init({values:b}),this.addChangeHandler(c),this.editingMap[a]={type:e,editor:c}},m.prototype.start=function(a,b){var c;if(this.editingId!==a.id){this.editingId&&this.end(),this.row=a,this.editingId=a.id,this.editingMap={};for(c in b)this._editCell(c,b[c])}},m.prototype.change=function(a){var b,c,d,e;if(this.editingId)for(b in a)c=a[b],d=this.getEditorType(a[b]),e=d.type,(this.editingMap[b].type!==e||"select"===e||"advancedSelect"===e)&&(this.editingMap[b].editor.destroy(),this._editCell(b,a[b]))},m.prototype.end=function(){var a,b;for(a in this.editingMap)this.editingMap.hasOwnProperty(a)&&(b=this.editingMap[a].editor,b.destroy(),delete this.editingMap[a]);this.editingId&&("function"==typeof this.onEnd&&this.onEnd.call(l,this.row),l._updateHtmlRow(this.editingId)),this.row=null,this.editingId=null},m.prototype.addChangeHandler=function(a){a.subscribe("change",function(a){"function"==typeof this.onChange&&this.onChange.call(l,a.column,a.value)},this)},m.prototype.getRow=function(){return this.row},m.prototype.getRowId=function(){return this.editingId},m.prototype.updateRow=function(a){var b;for(b in a)a.hasOwnProperty(b)&&this.editingMap.hasOwnProperty(b)&&this.editingMap[b].editor.update(a[b])},this._editor=new m},a.prototype._editRow=function(a){{var c,d;this.domMap.body}"string"==typeof a&&(a=this.findRowById(a)),c=this._getRowById(a.id),d=this.edit.getEdit(c),this._editor.start(a,d),this._editor.onChange=function(c,d){{var e=this.edit.getDepend(),f=this._getRowById(a.id),g=this.edit.getEdit(f);this.edit.getHidden(f)}b.inArray(c,e)&&this._editor.change(g),this._emitCallback("onChange",[c,d,a])},this._editor.onEnd=function(a){if(a){var b=a.id,c=this._getRowById(b);this._checkRowValues(c),this._editor.onEnd=null}}},a.prototype._buildTableStructure=function(a){var c,d,e,f,g,h,i,j,k,l=this.options.class_prefix,m=this.options.columns,n=this.options.footer,o=b.getScrollWidth();for(a.innerHTML="",a.classList.add(l+"-table"),f=[],c=0,d=m.length;d>c;++c)h=m[c],f.push(""+(h.name?'id="'+h.name+'"':"")+'class="'+l+"-cell cell-"+c+'">'+h.text);for(e='<div class="'+l+'-header"><div '+f.join("</div><div ")+"</div>",a.innerHTML+=e,f=[],c=0,d=m.length;d>c;++c)h=m[c],f.push(""+(h.name?'id="'+h.name+'"':"")+'class="'+l+"-cell cell-"+c+'"><input></input>');for(e='<div class="'+l+'-header-filter"><div '+f.join("</div><div ")+"</div>",a.innerHTML+=e,e='<div class="'+l+'-body"></div>',a.innerHTML+=e,g=[],c=0,d=n.length;d>c;++c)h=n[c],g.push('class="ui-state-default '+l+'-footer-button" name="'+h+'"><span class="ui-icon ui-icon-'+h+'"></span>');e='<div class="'+l+'-footer">'+(g.length?"<div "+g.join("</div><div ")+"</div>":"")+'<div class="'+l+'-footer-counter"></div></div',a.innerHTML+=e,e='<div class="'+l+'-filter"><span></span></div>',a.innerHTML+=e,a.style.position="relative",i=a.querySelector("."+l+"-header"),i.style.width="-webkit-calc(100% - "+o+"px)",i.style.width="calc(100% - "+o+"px)",j=a.querySelector("."+l+"-header-filter"),j.style.width="-webkit-calc(100% - "+o+"px)",j.style.width="calc(100% - "+o+"px)",k=a.querySelector("."+l+"-filter"),k.style.width=o+"px"},a.prototype._selectRow=function(a){var b,c,d,e=this.domMap.body,f=this.options.select_class;if("string"==typeof a&&(a=this.findRowById(a)),a&&!a.classList.contains(f)){for(d=e.querySelectorAll("."+f),b=0,c=d.length;c>b;b++)d[b].classList.remove(f);a.classList.add(f),this._emitCallback("onSelectRow",a),this.options.auto_edit&&this._editRow(a.id)}},a.prototype._getSelectedRow=function(){var a=this.domMap.body,b=this.options.select_class,c=a.querySelectorAll("."+b);return c[0]},a.prototype._setDomMap=function(a){var b=this.options.class_prefix;this.domMap={table:a,body:a.querySelector("."+b+"-body"),filter_btn:a.querySelector("."+b+"-filter"),footer_count:a.querySelector("."+b+"-footer-counter"),filter_inputs:a.querySelectorAll("."+b+"-header-filter input"),footer_btns:a.querySelectorAll("."+b+"-footer-button")}},a.prototype._addEventHandlers=function(){var a=this,c=this.options.class_prefix,d=this.domMap.body,e=this.domMap.filter_inputs,f=this.domMap.footer_btns,g=this.domMap.filter_btn;b.addEvent(e,"keyup",function(){var b=this.parentNode.id,c=this.value;a._updateFilter(b,c)}),f.length&&b.addEvent(f,"mousedown",function(){a._footerBtnClick.call(a,this)}),b.addEvent(g,"click",function(b){a._showFilterMenu(b,this)}),b.addEvent(d,"click",function(b){var d,e=c+"-row",f=(a.options.select_class,function(a,b){return a?a.classList&&a.classList.contains(b)?a:f(a.parentNode,b):null});d=b.target.classList.contains(e)?b.target:f(b.target.parentNode,e),d&&a._selectRow.call(a,d)})},a.prototype._updateCounterText=function(){var a,b=this.options.counter_text,c=this.getRowCount(),d={from:1,to:c,total:c};for(a in d)b=b.split("{{"+a+"}}").join(d[a]);return this.domMap.footer_count.innerHTML=b,b},a.prototype._getRowHtml=function(a){var c,d,e,f,g,h,i,j=this.options.columns,k=this.options.class_prefix,l=[],m="";if(null!==a&&b.isObject(a)){for(this.edit?(f=this.edit.getEdit(a,!0),e=this.edit.getHidden(a)):(f={},e=[]),c=0,d=j.length;d>c;c++)g=j[c].name,h=i=a[g]||"",b.isObject(f[g])&&(i=f[g][1*h],void 0===i&&(i=h)),l.push('class="'+k+"-cell cell-"+c+'" name="'+g+'"><div class="cell-val" value="'+h+'">'+i+"</div>");m='<div class="'+k+'-row" id="'+a.id+'"><div '+l.join("</div><div ")+"</div></div>"}return m},a.prototype._getRowsHtml=function(){var a,b,c=this._getRows(),d="";for(a=0,b=c.length;b>a;a++)d+=this._getRowHtml(c[a]);return d},a.prototype._updateTable=function(){this.endEditRow(),this.domMap.body.innerHTML=this._getRowsHtml(),this._updateCounterText()},a.prototype._updateHtmlRow=function(a){var b,c,d,e;"string"==typeof a&&(a=this.findRowById(a)),b=this._getRowById(1*a.id),this._checkRowValues(b),c=this._getRowHtml(b),d=document.createElement("div"),d.innerHTML=c,e=d.firstChild,a.parentNode.replaceChild(e,a)},a.prototype._footerBtnClick=function(a){var b=a.getAttribute("name");this._emitCallback("onFooterClick",b)},a.prototype._showFilterMenu=function(a,b){this.options.showFilterMenu?(this.options.showFilterMenu.call(this.domMap.table,a,b),console.log("custom filter")):this.domMap.table.classList.toggle(this.options.filter_class)},a.prototype.setFilter=function(a){this.filter=a||{}},a.prototype.editFilter=function(a,b){console.log(a,b),this.filter[a]={likenocase:""+b}},a.prototype.removeFilter=function(a){delete this.filter[a]},a.prototype._updateFilter=function(a,b){this.editFilter(a,b),this._updateTable()
},a.prototype.getRowCount=function(){return this._getRows().length},a.prototype.getRowById=function(a){return this._getRowById(a)},a.prototype.getRowValues=function(a){var b=a||this._getSelectedRow()||"",c=this.table({id:b+""}).first();return c},a.prototype.editRow=function(a){var b=a||this._getSelectedRow();this._editRow(""+b)},a.prototype.endEditRow=function(){this._editor.end()},a.prototype.newRow=function(a){a=a||{},this._insertRow(a),this._updateTable()},a.prototype.newRows=function(a){var b,c=a.length;for(b=0;c>b;b++)this._insertRow(a[b]);this._updateTable()},a.prototype.updateRow=function(a,b,c,d){this._updateRow(a,b,d),c?this._editor.getRowId()==a?this._editor.updateRow(b):this._updateHtmlRow(a):(this._editor.end(),this._updateTable())},a.prototype.deleteRow=function(a){var b=this.findNextRow(a);this._editor.getRowId()===a&&this._editor.end(),this._deleteRow(a),this._updateTable(),this._selectRow(b)},a.prototype.deleteEditRow=function(){if(this._editor.getRow()){var a=this._editor.getRowId();this.deleteRow(a)}},a.prototype.deleteSelectedRow=function(){var a=this._getSelectedRow();a&&this.deleteRow(a.id)},a.prototype.findRowById=function(a){return this.domMap.body.querySelector('[id="'+a+'"]')},a.prototype.findNextRow=function(a){var b,c,d,e=this._getRows();for(b=0,c=e.length;c>b;b++)if(e[b].id===a){d=e[b+1];break}return d},a.prototype.newTable=function(){return this._currentTableId=(new Date).getTime(),this.table=TAFFY(),window.table=this.table,this._saveMap[this._currentTableId]=this.table,this._updateTable(),this._currentTableId},a.prototype.restoreTable=function(a){var b=!1;return this._saveMap.hasOwnProperty(a)&&(this.table=this._saveMap[a],this.table_id=a,b=!0,this._updateTable()),b},a.prototype.destroy=function(a){this._saveMap.hasOwnProperty(a)&&(this._currentTableId===a&&this.newTable(),delete this._saveMap[a])},a.prototype.saveStatus=function(){this.table({deleted:"true"}).remove(),this.table().update({"new":"false",edited:"false",deleted:"false"})},a.prototype.getNewRows=function(a){var c,d,e={"new":"true"},f={};if(a){for(c in this._saveMap)f[c]=this._saveMap[c](e).get();d=b.clone(f)}else d=b.clone(this.table(e).get());return d},a.prototype.getEditedRows=function(a){var c,d={edited:"true"},e={};if(a){for(c in this._saveMap)e[c]=this._saveMap[c](d).get();return b.clone(e)}return b.clone(this.table(d).get())},a.prototype.getDeletedRows=function(a){var c,d={deleted:"true"},e={};if(a){for(c in this._saveMap)e[c]=this._saveMap[c](d).get();return b.clone(e)}return b.clone(this.table(d).get())},a.prototype.isStatusChanged=function(a){var b,c,d,e,f,g=["getNewRows","getEditedRows","getDeletedRows"],h=0;if(a){for(b=0,c=g.length;c>b;++b){f=g[b],e=this[f](a);for(d in e)h+=e[d].length}return h}return this.getNewRows().length+this.getEditedRows().length+this.getDeletedRows().length>0};var b={getScrollWidth:function(){var a,b,c,d;return a=document.createElement("div"),a.style.visibility="hidden",a.style.width="100px",a.style.msOverflowStyle="scrollbar",document.body.appendChild(a),c=a.offsetWidth,a.style.overflow="scroll",b=document.createElement("div"),b.style.width="100%",a.appendChild(b),d=b.offsetWidth,a.parentNode.removeChild(a),c-d},inArray:function(a,b){var c,d;if("[object Array]"===Object.prototype.toString.call(b))for(c=0,d=b.length;d>c;++c)if(""+a==""+b[c])return!0;return!1},extend:function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},getType:function(a){return Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"===b.getType(a)},isArray:function(a){return"[object Array]"===b.getType(a)},clone:function(a){var c,d,e;if(b.isArray(a)){for(e=[],c=0,d=a.length;d>c;++c)e[c]=b.isArray(a[c])||b.isObject(a[c])?b.clone(a[c]):a[c];return e}if(b.isObject(a)){e={};for(c in a)a.hasOwnProperty(c)&&(e[c]=b.isArray(a[c])||b.isObject(a[c])?b.clone(a[c]):a[c]);return e}return a},getArrayByKey:function(a,b){var c,d,e=[];for(c=0,d=a.length;d>c;++c)a[c].hasOwnProperty(b)&&e.push(a[c][b]);return e},addEvent:function(a,c){return c.addEventListener?function(c,d,e){if(c&&!c.length||c===a)c.addEventListener(d,e,!1);else if(c&&c.length)for(var f=c.length,g=0;f>g;g++)b.addEvent(c[g],d,e)}:c.attachEvent?function(c,d,e){if(c&&!c.length||c===a)c.attachEvent("on"+d,function(){return e.call(c,a.event)});else if(c.length)for(var f=c.length,g=0;f>g;g++)b.addEvent(c[g],d,e)}:void 0}(this,document),removeEvent:function(a,c){return c.removeEventListener?function(c,d,e){if(c&&!c.length||c===a)c.removeEventListener(d,e,!1);else if(c&&c.length)for(var f=c.length,g=0;f>g;g++)b.removeEvent(c[g],d,e)}:c.detachEvent?function(c,d,e){if(c&&!c.length||c===a)c.detachEvent("on"+d,function(){return e.call(c,a.event)});else if(c.length)for(var f=c.length,g=0;f>g;g++)b.removeEvent(c[g],d,e)}:void 0}(this,document)};return function(b,c){var d,e=function(){};return e.div_table=function(){var a=[].shift.apply(arguments);if("_"===a[0])throw"You can't call a private method!";return"function"==typeof d[a]?d[a].apply(d,arguments):void console.warn(a,"is not a callable function")},d=new a,d.init(b,c,e),e}}();window.jQuery&&(jQuery.fn.div_table=function(a){return divTableMaker(this[0],a)});